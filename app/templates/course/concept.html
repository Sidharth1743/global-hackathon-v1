{% extends "base.html" %}

{% block title %}{{ concept.name }} - Neo4j Learning Platform{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('course.course_list') }}">Concepts</a></li>
                <li class="breadcrumb-item active">{{ concept.name }}</li>
            </ol>
        </nav>
        
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1>{{ concept.name }}</h1>
                <p class="text-muted">Explore this concept and its connections</p>
            </div>
            <div>
                {% if concept.difficulty == 'Beginner' %}
                    <span class="badge bg-primary fs-6">{{ concept.difficulty }}</span>
                {% elif concept.difficulty == 'Intermediate' %}
                    <span class="badge bg-warning fs-6">{{ concept.difficulty }}</span>
                {% else %}
                    <span class="badge bg-danger fs-6">{{ concept.difficulty }}</span>
                {% endif %}
                
                {% if concept.completed %}
                    <span class="badge bg-success fs-6 ms-2">
                        <i class="fas fa-check me-1"></i>Completed
                    </span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Main Content -->
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info-circle me-2"></i>About This Concept</h5>
            </div>
            <div class="card-body">
                <p>This is a core concept in MIT's Introduction to Probability and Statistics course.</p>
                
                <p>Understanding <strong>{{ concept.name }}</strong> is essential for building a solid 
                foundation in statistical thinking and analysis.</p>
                
                {% if not concept.completed %}
                <div class="alert alert-info">
                    <i class="fas fa-lightbulb me-2"></i>
                    <strong>Learning Tip:</strong> Take your time with this concept and explore 
                    its connections to other topics using the knowledge graph.
                </div>
                
                <div class="d-grid gap-2">
                    <button class="btn btn-success btn-lg" onclick="markComplete('{{ concept.id }}')">
                        <i class="fas fa-check me-2"></i>Mark as Complete
                    </button>
                </div>
                {% else %}
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>Great job!</strong> You've completed this concept. 
                    Check out the related concepts below.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Prerequisites -->
        {% if prerequisites %}
        <div class="card mb-4">
            <div class="card-header">
                <h6><i class="fas fa-arrow-left me-2"></i>Prerequisites</h6>
            </div>
            <div class="card-body">
                {% for prereq in prerequisites %}
                <div class="d-flex align-items-center mb-2">
                    <span class="badge bg-secondary me-2">
                        {{ prereq.difficulty[0] }}
                    </span>
                    <a href="{{ url_for('course.concept_detail', concept_id=prereq.id) }}" 
                       class="text-decoration-none">
                        {{ prereq.name }}
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Next Concepts -->
        {% if next_concepts %}
        <div class="card mb-4">
            <div class="card-header">
                <h6><i class="fas fa-arrow-right me-2"></i>What's Next</h6>
            </div>
            <div class="card-body">
                {% for next_concept in next_concepts %}
                <div class="d-flex align-items-center mb-2">
                    <span class="badge bg-secondary me-2">
                        {{ next_concept.difficulty[0] }}
                    </span>
                    <a href="{{ url_for('course.concept_detail', concept_id=next_concept.id) }}" 
                       class="text-decoration-none">
                        {{ next_concept.name }}
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-tools me-2"></i>Actions</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('graph_view') }}" class="btn btn-outline-primary">
                        <i class="fas fa-sitemap me-2"></i>View in Graph
                    </a>
                    <a href="{{ url_for('course.course_list') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-list me-2"></i>All Concepts
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function markComplete(conceptId) {
    const button = event.target;
    const originalText = button.innerHTML;
    
    button.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Updating...';
    button.disabled = true;
    
    fetch(`/api/concept/${conceptId}/complete`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload(); // Refresh to show updated status
        } else {
            button.innerHTML = originalText;
            button.disabled = false;
            alert('Error updating progress');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        button.innerHTML = originalText;
        button.disabled = false;
        alert('Error updating progress');
    });
}
</script>
{% endblock %}